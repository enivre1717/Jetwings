"use strict";arrival_form.controller("ArrivalFormController",["$scope","$rootScope","$route","$location","$http","$uibModal","arrivalFormModel","fitFlightsModel",function($scope,$rootScope,$route,$location,$http,$uibModal,arrivalFormModel,fitFlightsModel){var fitBookingId=$route.current.params.fitBookingId;arrivalFormModel.getArrivalFormDetails(fitBookingId).then(function(results){results.data.length>0?($scope.arrivalForms=results.data[0],$scope.hasSubmitted=!0):($scope.arrivalForms={},$scope.hasSubmitted=!1,fitFlightsModel.getArrivalDetails(fitBookingId,2).then(function(results){results.data?($scope.arrivalForms.fit_booking_id=results.data[0].id,$scope.arrivalForms.tour_code=results.data[0].tour_code,angular.forEach(results.data[0].calls,function(value,key){angular.forEach(value.flights,function(v,k){"Arrival"==v.type?($scope.arrivalForms.two_nd_arrival=v.flight_no,$scope.arrivalForms.departure_date=v.arrival_at,$scope.arrivalForms.arrival_time=""!=v.arrival_at_1?v.arrival_at_1:v.arrival_at):"Departure"==v.type&&($scope.arrivalForms.departure_flight=v.flight_no,$scope.arrivalForms.departure_time=""!=v.departure_at_1?v.departure_at_1:v.departure_at)})})):console.log("Invalid booking.")}).catch(function(error){401==error.status?$location.path("/"):console.log("Error occurred in retrieving booking details.")}))}).catch(function(error){401==error.status?$location.path("/"):console.log("Error occurred in retrieving arrival details.")}),$scope.submitForm=function(arrivalForms){arrivalForms.tourGuideSignature='{"lines":[]}'!=$("#tour_guide_signature").val()?$("#tour_guide_signature").val():"",arrivalForms.tourLeaderSignature='{"lines":[]}'!=$("#tour_leader_signature").val()?$("#tour_leader_signature").val():"",arrivalFormModel.submitForms(arrivalForms).then(function(results){void 0!==results.data.errors&&Object.keys(results.data.errors).length>0?$scope.errors=results.data.errors:("true"==results.data?$rootScope.showNotification("二次交接与离新确认书已成功提交。","success"):$rootScope.showNotification("二次交接与离新确认书未提交。","error"),$location.path("/fitbookings/forms/"+arrivalForms.fit_booking_id))}).catch(function(error){401==error.status?$location.path("/"):console.log("Error occurred in submitting arrival form.")})},$("#TourGuideSignature").signature({syncField:$("#TourGuideSignature").next("input")}),$("#TourLeaderSignature").signature({syncField:$("#TourLeaderSignature").next("input")}),$(".clearButton a").click(function(e){e.preventDefault(),$(this).parents(".sigWrapper").find(".sigPad").signature("clear"),$(this).parents(".sigWrapper").find(".sigPad").next("input").val("")})}]);